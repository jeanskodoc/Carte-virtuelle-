<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syst√®me de Gestion Bancaire - Clients et Transactions</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }
        
        .login-title {
            text-align: center;
            color: #1a2a6c;
            margin-bottom: 30px;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
        }
        
        .login-error {
            background: #fdeaea;
            color: #e74c3c;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 1100px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        h2 {
            color: #1a2a6c;
            border-bottom: 2px solid #fdbb2d;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .card {
            width: 100%;
            max-width: 400px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            border-radius: 15px;
            padding: 25px;
            color: white;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin: 0 auto 20px;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(45deg);
            z-index: 0;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .card-logo {
            font-size: 24px;
            font-weight: bold;
        }
        
        .card-type {
            background: #fdbb2d;
            color: #1a2a6c;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .card-number {
            font-size: 24px;
            letter-spacing: 3px;
            text-align: center;
            margin: 20px 0;
            position: relative;
            z-index: 1;
            font-family: 'Courier New', monospace;
        }
        
        .card-details {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }
        
        .card-holder, .card-expiry {
            display: flex;
            flex-direction: column;
        }
        
        .card-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .card-value {
            font-size: 16px;
            font-weight: bold;
        }
        
        .card-cvv {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .credentials {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            width: 100%;
            max-width: 400px;
            margin: 20px auto 0;
        }
        
        .credential-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ddd;
        }
        
        .credential-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .credential-label {
            font-weight: 600;
        }
        
        .credential-value {
            font-family: 'Courier New', monospace;
            background: #eee;
            padding: 3px 8px;
            border-radius: 4px;
        }
        
        .hidden {
            display: none;
        }
        
        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        .card-chip {
            width: 50px;
            height: 40px;
            background: linear-gradient(135deg, #c9c9c9, #e0e0e0);
            border-radius: 5px;
            position: relative;
            margin-bottom: 20px;
        }
        
        .card-chip::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 25px;
            background: linear-gradient(135deg, #a0a0a0, #c0c0c0);
            border-radius: 3px;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .clients-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .clients-table th, .clients-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .clients-table th {
            background-color: #f2f2f2;
            font-weight: 600;
            color: #1a2a6c;
        }
        
        .clients-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background-color: #e7f7ef;
            color: #2ecc71;
        }
        
        .status-expired {
            background-color: #fdeaea;
            color: #e74c3c;
        }
        
        .status-warning {
            background-color: #fef5e7;
            color: #f39c12;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #1a2a6c;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            padding: 5px;
        }
        
        .action-btn:hover {
            text-decoration: underline;
        }
        
        .card-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #777;
        }
        
        .empty-state p {
            margin-bottom: 20px;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Styles pour les transactions */
        .transaction-form {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .transaction-history {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-type {
            font-weight: bold;
        }
        
        .transaction-amount {
            font-weight: bold;
        }
        
        .transaction-positive {
            color: #2ecc71;
        }
        
        .transaction-negative {
            color: #e74c3c;
        }
        
        .transaction-fee {
            color: #f39c12;
            font-size: 0.9em;
        }
        
        .account-balance {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: #1a2a6c;
        }
        
        .transaction-section {
            margin-top: 30px;
        }
        
        .transaction-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .transaction-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .transaction-tab.active {
            border-bottom: 3px solid #1a2a6c;
            color: #1a2a6c;
            font-weight: bold;
        }
        
        .transaction-panel {
            display: none;
        }
        
        .transaction-panel.active {
            display: block;
        }
        
        .transaction-reference {
            font-size: 0.8em;
            color: #777;
            margin-top: 5px;
        }
        
        .print-btn {
            background: #2ecc71;
            margin-top: 10px;
            margin-right: 10px;
        }
        
        .print-btn:hover {
            background: #27ae60;
        }
        
        .save-btn {
            background: #3498db;
            margin-top: 10px;
            margin-right: 10px;
        }
        
        .save-btn:hover {
            background: #2980b9;
        }
        
        .import-btn {
            background: #9b59b6;
            margin-top: 10px;
        }
        
        .import-btn:hover {
            background: #8e44ad;
        }
        
        /* Styles pour l'impression */
        @media print {
            body * {
                visibility: hidden;
            }
            #printable-transactions, #printable-transactions * {
                visibility: visible;
            }
            #printable-transactions {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
            .no-print {
                display: none !important;
            }
        }
        
        .transaction-details {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .transaction-party {
            font-size: 0.9em;
            color: #555;
        }
        
        .transaction-date {
            font-size: 0.8em;
            color: #777;
        }
        
        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .backup-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .backup-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .backup-info {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .file-input-container {
            position: relative;
            margin: 15px 0;
        }
        
        .file-input {
            position: absolute;
            left: -9999px;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 10px 15px;
            background: #9b59b6;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .file-input-label:hover {
            background: #8e44ad;
        }
        
        .import-options {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .import-option {
            margin: 10px 0;
        }
        
        .warning-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .import-preview {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background: white;
        }
        
        .auto-save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }
        
        .session-info {
            background: #e7f7ef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- √âcran de connexion -->
    <div id="loginScreen" class="login-container">
        <h2 class="login-title">Connexion</h2>
        <div id="loginError" class="login-error">
            Identifiant ou mot de passe incorrect
        </div>
        <form id="loginForm" class="login-form">
            <div class="form-group">
                <label for="username">Identifiant</label>
                <input type="text" id="username" required>
            </div>
            
            <div class="form-group">
                <label for="password">Mot de passe</label>
                <input type="password" id="password" required>
            </div>
            
            <button type="submit">Se connecter</button>
        </form>
    </div>
    
    <!-- Application principale (cach√©e par d√©faut) -->
    <div id="mainApp" class="hidden">
        <button id="logoutBtn" class="logout-btn">D√©connexion</button>
        <h1>Syst√®me de Gestion Bancaire - Clients et Transactions</h1>
        
        <!-- Indicateur de sauvegarde automatique -->
        <div id="autoSaveStatus" class="auto-save-status">
            Sauvegarde automatique en cours...
        </div>
        
        <div class="container">
            <div>
                <div class="panel">
                    <h2>Enregistrement du Client</h2>
                    <form id="clientForm">
                        <div class="form-group">
                            <label for="firstName">Pr√©nom</label>
                            <input type="text" id="firstName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName">Nom</label>
                            <input type="text" id="lastName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="birthDate">Date de Naissance</label>
                            <input type="date" id="birthDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Adresse</label>
                            <input type="text" id="address" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="city">Ville</label>
                            <input type="text" id="city" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="phoneNumber">Num√©ro de T√©l√©phone</label>
                            <input type="tel" id="phoneNumber" placeholder="Ex: +225 07 12 34 56 78" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardType">Type de Carte</label>
                            <select id="cardType" required>
                                <option value="visa">Visa</option>
                                <option value="mastercard">Mastercard</option>
                                <option value="virtual">Carte Virtuelle</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="initialBalance">Solde Initial (FCFA)</label>
                            <input type="number" id="initialBalance" value="0" min="0">
                        </div>
                        
                        <button type="submit">G√©n√©rer la Carte</button>
                    </form>
                    
                    <div id="successMessage" class="success-message">
                        Carte g√©n√©r√©e avec succ√®s! Valide pour 2 ans √† partir d'aujourd'hui.
                    </div>
                </div>
                
                <div class="panel card-preview">
                    <h2>Votre Carte Bancaire</h2>
                    <div class="card hidden" id="bankCard">
                        <div class="card-header">
                            <div class="card-logo" id="cardLogo">VISA</div>
                            <div class="card-type" id="cardTypeDisplay">Virtuelle</div>
                        </div>
                        
                        <div class="card-chip"></div>
                        
                        <div class="card-number" id="cardNumberDisplay">**** **** **** ****</div>
                        
                        <div class="card-details">
                            <div class="card-holder">
                                <div class="card-label">Titulaire</div>
                                <div class="card-value" id="cardHolderDisplay">-</div>
                            </div>
                            
                            <div class="card-expiry">
                                <div class="card-label">Expire</div>
                                <div class="card-value" id="cardExpiryDisplay">-</div>
                            </div>
                            
                            <div class="card-cvv">
                                <div class="card-label">CVV</div>
                                <div class="card-value" id="cardCvvDisplay">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="credentials hidden" id="credentials">
                        <div class="credential-item">
                            <div class="credential-label">Identifiant de connexion:</div>
                            <div class="credential-value" id="userIdDisplay">-</div>
                        </div>
                        
                        <div class="credential-item">
                            <div class="credential-label">Mot de passe temporaire:</div>
                            <div class="credential-value" id="passwordDisplay">-</div>
                        </div>
                        
                        <div class="credential-item">
                            <div class="credential-label">Date d'expiration:</div>
                            <div class="credential-value" id="expiryDateDisplay">-</div>
                        </div>
                    </div>
                    
                    <div id="noCardMessage" class="empty-state">
                        <p>Aucune carte g√©n√©r√©e. Veuillez remplir le formulaire.</p>
                    </div>
                </div>
                
                <!-- Section des transactions -->
                <div class="panel transaction-section hidden" id="transactionSection">
                    <h2>Gestion des Transactions</h2>
                    
                    <div class="account-balance" id="accountBalance">
                        Solde: 0 FCFA
                    </div>
                    
                    <div class="transaction-tabs">
                        <div class="transaction-tab active" data-tab="recharge">Recharger</div>
                        <div class="transaction-tab" data-tab="transfer">Transfert</div>
                        <div class="transaction-tab" data-tab="receive">R√©ception</div>
                        <div class="transaction-tab" data-tab="withdraw">Retrait</div>
                    </div>
                    
                    <!-- Formulaire de recharge -->
                    <div class="transaction-panel active" id="rechargePanel">
                        <form id="rechargeForm" class="transaction-form">
                            <div class="form-group">
                                <label for="rechargeAmount">Montant √† recharger (FCFA)</label>
                                <input type="number" id="rechargeAmount" min="100" required>
                            </div>
                            <div class="form-group">
                                <p>Frais de service: 6% du montant</p>
                            </div>
                            <button type="submit">Recharger la carte</button>
                        </form>
                    </div>
                    
                    <!-- Formulaire de transfert -->
                    <div class="transaction-panel" id="transferPanel">
                        <form id="transferForm" class="transaction-form">
                            <div class="form-group">
                                <label for="transferAmount">Montant √† transf√©rer (FCFA)</label>
                                <input type="number" id="transferAmount" min="100" required>
                            </div>
                            <div class="form-group">
                                <label for="transferRecipient">Nom du destinataire</label>
                                <input type="text" id="transferRecipient" placeholder="Nom du destinataire" required>
                            </div>
                            <div class="form-group">
                                <label for="transferPhone">Num√©ro du destinataire</label>
                                <input type="tel" id="transferPhone" placeholder="Ex: +225 07 12 34 56 78" required>
                            </div>
                            <button type="submit">Effectuer le transfert</button>
                        </form>
                    </div>
                    
                    <!-- Formulaire de r√©ception -->
                    <div class="transaction-panel" id="receivePanel">
                        <form id="receiveForm" class="transaction-form">
                            <div class="form-group">
                                <label for="receiveAmount">Montant re√ßu (FCFA)</label>
                                <input type="number" id="receiveAmount" min="100" required>
                            </div>
                            <div class="form-group">
                                <label for="receiveSender">Nom de l'exp√©diteur</label>
                                <input type="text" id="receiveSender" placeholder="Nom de l'exp√©diteur" required>
                            </div>
                            <div class="form-group">
                                <label for="receiveSenderPhone">Num√©ro de l'exp√©diteur</label>
                                <input type="tel" id="receiveSenderPhone" placeholder="Ex: +225 07 12 34 56 78" required>
                            </div>
                            <button type="submit">Enregistrer la r√©ception</button>
                        </form>
                    </div>
                    
                    <!-- Formulaire de retrait -->
                    <div class="transaction-panel" id="withdrawPanel">
                        <form id="withdrawForm" class="transaction-form">
                            <div class="form-group">
                                <label for="withdrawAmount">Montant √† retirer (FCFA)</label>
                                <input type="number" id="withdrawAmount" min="100" required>
                            </div>
                            <div class="form-group">
                                <label for="withdrawPhone">Num√©ro Mobile Money</label>
                                <input type="tel" id="withdrawPhone" placeholder="Ex: +225 07 12 34 56 78" required>
                            </div>
                            <div class="form-group">
                                <p>Frais de service: 15% du montant</p>
                            </div>
                            <button type="submit">Effectuer le retrait</button>
                        </form>
                    </div>
                    
                    <!-- Historique des transactions -->
                    <div class="transaction-history">
                        <div class="header-actions">
                            <h3>Historique des Transactions</h3>
                            <div>
                                <button id="printTransactions" class="print-btn">Imprimer</button>
                                <button id="saveTransactions" class="save-btn">Sauvegarder</button>
                            </div>
                        </div>
                        <div id="transactionHistory">
                            <!-- Les transactions seront ajout√©es ici dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="header-actions">
                    <h2>Liste des Clients et Cartes</h2>
                    <button id="saveClientsTable" class="save-btn">Sauvegarder</button>
                </div>
                
                <!-- Information de session -->
                <div class="session-info">
                    <p><strong>Session active depuis:</strong> <span id="sessionStartTime">-</span></p>
                    <p><strong>Derni√®re sauvegarde auto:</strong> <span id="lastAutoSaveTime">-</span></p>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="searchClient">Rechercher un client</label>
                        <input type="text" id="searchClient" placeholder="Nom, pr√©nom ou ville">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterStatus">Filtrer par statut</label>
                        <select id="filterStatus">
                            <option value="all">Tous les statuts</option>
                            <option value="active">Valide</option>
                            <option value="warning">Bient√¥t expir√©</option>
                            <option value="expired">Expir√©</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterCardType">Filtrer par type de carte</label>
                        <select id="filterCardType">
                            <option value="all">Tous les types</option>
                            <option value="visa">Visa</option>
                            <option value="mastercard">Mastercard</option>
                            <option value="virtual">Virtuelle</option>
                        </select>
                    </div>
                </div>
                
                <table class="clients-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Type de carte</th>
                            <th>Num√©ro de carte</th>
                            <th>Solde (FCFA)</th>
                            <th>Date d'expiration</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTableBody">
                        <!-- Les lignes seront ajout√©es dynamiquement -->
                    </tbody>
                </table>
                
                <div id="noClientsMessage" class="empty-state">
                    <p>Aucun client enregistr√© pour le moment.</p>
                </div>
            </div>
            
            <!-- Section de sauvegarde et importation -->
            <div class="panel backup-section">
                <h2>Sauvegarde et Importation des Donn√©es</h2>
                <p>G√©rez vos donn√©es en les sauvegardant localement ou en important des donn√©es pr√©c√©demment sauvegard√©es.</p>
                
                <div class="backup-buttons">
                    <button id="backupAllData" class="save-btn">Sauvegarder toutes les donn√©es</button>
                    <button id="backupClients" class="save-btn">Sauvegarder les clients</button>
                    <button id="backupTransactions" class="save-btn">Sauvegarder les transactions</button>
                </div>
                
                <div class="backup-info">
                    <p><strong>Derni√®re sauvegarde manuelle:</strong> <span id="lastBackupTime">-</span></p>
                    <p><strong>Derni√®re sauvegarde automatique:</strong> <span id="lastAutoBackupTime">-</span></p>
                    <p><strong>Emplacement:</strong> Les sauvegardes sont t√©l√©charg√©es dans votre dossier de t√©l√©chargements</p>
                </div>
                
                <hr style="margin: 20px 0;">
                
                <h3>Importer des Donn√©es</h3>
                <p>S√©lectionnez un fichier JSON pr√©c√©demment sauvegard√© pour importer les donn√©es dans le syst√®me.</p>
                
                <div class="file-input-container">
                    <input type="file" id="importFile" class="file-input" accept=".json">
                    <label for="importFile" class="file-input-label">Choisir un fichier JSON</label>
                    <span id="fileName" style="margin-left: 10px;">Aucun fichier s√©lectionn√©</span>
                </div>
                
                <div class="import-options">
                    <div class="import-option">
                        <input type="radio" id="importReplace" name="importMode" value="replace" checked>
                        <label for="importReplace">Remplacer toutes les donn√©es existantes</label>
                    </div>
                    <div class="import-option">
                        <input type="radio" id="importMerge" name="importMode" value="merge">
                        <label for="importMerge">Fusionner avec les donn√©es existantes</label>
                    </div>
                </div>
                
                <div class="warning-message">
                    <strong>Attention:</strong> Le remplacement supprimera toutes les donn√©es actuelles. La fusion peut cr√©er des doublons.
                </div>
                
                <div id="importPreview" class="import-preview hidden">
                    <!-- Aper√ßu des donn√©es √† importer -->
                </div>
                
                <div class="backup-buttons">
                    <button id="importData" class="import-btn" disabled>Importer les Donn√©es</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Section pour l'impression (cach√©e par d√©faut) -->
    <div id="printable-transactions" class="hidden">
        <!-- Le contenu sera g√©n√©r√© dynamiquement pour l'impression -->
    </div>

    <script>
        // Identifiants de connexion
        const VALID_USERNAME = 'KOLA';
        const VALID_PASSWORD = 'KOLA1@';
        
        // Variables globales
        let clients = [];
        let currentClientId = null;
        let sessionStartTime = null;
        let autoSaveInterval = null;
        let lastAutoSaveTime = null;
        
        // V√©rifier si l'utilisateur est d√©j√† connect√©
        function checkAuth() {
            return localStorage.getItem('userAuthenticated') === 'true';
        }
        
        // Initialiser l'application
        function initializeApp() {
            // Charger les donn√©es depuis le localStorage
            loadDataFromStorage();
            
            // D√©marrer la session
            startSession();
            
            // D√©marrer la sauvegarde automatique
            startAutoSave();
            
            // Mettre √† jour l'interface
            updateClientsTable();
            updateSessionInfo();
        }
        
        // Charger les donn√©es depuis le stockage
        function loadDataFromStorage() {
            const savedClients = localStorage.getItem('bankClients');
            if (savedClients) {
                try {
                    clients = JSON.parse(savedClients);
                    console.log(`Donn√©es charg√©es: ${clients.length} clients`);
                } catch (error) {
                    console.error('Erreur lors du chargement des donn√©es:', error);
                    clients = [];
                }
            } else {
                clients = [];
            }
        }
        
        // D√©marrer une nouvelle session
        function startSession() {
            sessionStartTime = new Date();
            localStorage.setItem('sessionStartTime', sessionStartTime.toISOString());
        }
        
        // D√©marrer la sauvegarde automatique
        function startAutoSave() {
            // Sauvegarde toutes les 30 secondes
            autoSaveInterval = setInterval(() => {
                autoSaveData();
            }, 30000);
            
            // Sauvegarde aussi quand l'utilisateur quitte la page
            window.addEventListener('beforeunload', autoSaveData);
        }
        
        // Sauvegarde automatique des donn√©es
        function autoSaveData() {
            try {
                localStorage.setItem('bankClients', JSON.stringify(clients));
                lastAutoSaveTime = new Date();
                localStorage.setItem('lastAutoSaveTime', lastAutoSaveTime.toISOString());
                
                // Afficher bri√®vement l'indicateur de sauvegarde
                showAutoSaveStatus();
                
                console.log('Sauvegarde automatique effectu√©e');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde automatique:', error);
            }
        }
        
        // Afficher l'indicateur de sauvegarde
        function showAutoSaveStatus() {
            const statusElement = document.getElementById('autoSaveStatus');
            statusElement.textContent = '‚úì Donn√©es sauvegard√©es';
            statusElement.style.display = 'block';
            statusElement.style.background = '#2ecc71';
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 2000);
        }
        
        // Mettre √† jour les informations de session
        function updateSessionInfo() {
            if (sessionStartTime) {
                document.getElementById('sessionStartTime').textContent = formatDateTime(sessionStartTime);
            }
            
            const savedLastAutoSave = localStorage.getItem('lastAutoSaveTime');
            if (savedLastAutoSave) {
                lastAutoSaveTime = new Date(savedLastAutoSave);
                document.getElementById('lastAutoSaveTime').textContent = formatDateTime(lastAutoSaveTime);
                document.getElementById('lastAutoBackupTime').textContent = formatDateTime(lastAutoSaveTime);
            }
            
            const savedLastBackup = localStorage.getItem('lastBackupTime');
            if (savedLastBackup) {
                document.getElementById('lastBackupTime').textContent = formatDateTime(new Date(savedLastBackup));
            }
        }
        
        // Gestion de la connexion
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                // Authentification r√©ussie
                localStorage.setItem('userAuthenticated', 'true');
                showMainApp();
                initializeApp();
            } else {
                // Authentification √©chou√©e
                document.getElementById('loginError').style.display = 'block';
            }
        });
        
        // Gestion de la d√©connexion
        document.getElementById('logoutBtn').addEventListener('click', function() {
            // Sauvegarder avant de quitter
            autoSaveData();
            
            // Arr√™ter la sauvegarde automatique
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            localStorage.removeItem('userAuthenticated');
            showLoginScreen();
        });
        
        // Afficher l'√©cran de connexion
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('loginForm').reset();
        }
        
        // Afficher l'application principale
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }
        
        // V√©rifier l'authentification au chargement
        if (checkAuth()) {
            showMainApp();
            // Initialiser apr√®s un court d√©lai pour s'assurer que le DOM est charg√©
            setTimeout(initializeApp, 100);
        } else {
            showLoginScreen();
        }
        
        // Initialisation de l'interface
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuth()) {
                // Les √©couteurs d'√©v√©nements seront configur√©s dans initializeApp
                // Mais nous devons en mettre quelques-uns ici pour le chargement initial
                document.getElementById('filterStatus').addEventListener('change', updateClientsTable);
                document.getElementById('filterCardType').addEventListener('change', updateClientsTable);
                document.getElementById('searchClient').addEventListener('input', updateClientsTable);
                
                // Gestion des onglets de transaction
                document.querySelectorAll('.transaction-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        switchTransactionTab(tabId);
                    });
                });
                
                // Gestion des formulaires de transaction
                document.getElementById('rechargeForm').addEventListener('submit', handleRecharge);
                document.getElementById('transferForm').addEventListener('submit', handleTransfer);
                document.getElementById('receiveForm').addEventListener('submit', handleReceive);
                document.getElementById('withdrawForm').addEventListener('submit', handleWithdraw);
                
                // Gestion du bouton d'impression
                document.getElementById('printTransactions').addEventListener('click', printTransactions);
                
                // Gestion des boutons de sauvegarde
                document.getElementById('saveTransactions').addEventListener('click', saveTransactions);
                document.getElementById('backupAllData').addEventListener('click', backupAllData);
                document.getElementById('backupClients').addEventListener('click', backupClients);
                document.getElementById('backupTransactions').addEventListener('click', backupTransactions);
                document.getElementById('saveClientsTable').addEventListener('click', saveClientsTable);
                
                // Gestion de l'importation
                document.getElementById('importFile').addEventListener('change', handleFileSelect);
                document.getElementById('importData').addEventListener('click', importData);
            }
        });
        
        // Gestion du formulaire de cr√©ation de client
        document.getElementById('clientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // R√©cup√©ration des donn√©es du formulaire
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const birthDate = document.getElementById('birthDate').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const cardType = document.getElementById('cardType').value;
            const initialBalance = parseFloat(document.getElementById('initialBalance').value) || 0;
            
            // G√©n√©ration des informations de la carte
            const cardNumber = generateCardNumber(cardType);
            const cvv = generateCVV();
            const issueDate = new Date();
            const expiryDate = new Date();
            expiryDate.setFullYear(expiryDate.getFullYear() + 2); // Validit√© de 2 ans
            
            // G√©n√©ration des identifiants
            const userId = generateUserId();
            const password = generatePassword();
            
            // Formatage des dates
            const formattedExpiryDate = formatDate(expiryDate);
            const formattedExpiryDisplay = `${('0' + (expiryDate.getMonth() + 1)).slice(-2)}/${expiryDate.getFullYear().toString().slice(-2)}`;
            
            // Cr√©ation de l'objet client
            const client = {
                id: generateClientId(),
                firstName: firstName,
                lastName: lastName,
                birthDate: birthDate,
                address: address,
                city: city,
                phoneNumber: phoneNumber,
                cardType: cardType,
                cardNumber: cardNumber,
                cvv: cvv,
                issueDate: issueDate.toISOString(),
                expiryDate: expiryDate.toISOString(),
                userId: userId,
                password: password,
                balance: initialBalance,
                status: getCardStatus(expiryDate),
                transactions: []
            };
            
            // Ajout du client √† la liste
            clients.push(client);
            
            // Sauvegarde automatique
            autoSaveData();
            
            // Mise √† jour de la carte affich√©e
            document.getElementById('cardHolderDisplay').textContent = `${firstName} ${lastName}`.toUpperCase();
            document.getElementById('cardNumberDisplay').textContent = formatCardNumber(cardNumber);
            document.getElementById('cardExpiryDisplay').textContent = formattedExpiryDisplay;
            document.getElementById('cardCvvDisplay').textContent = cvv;
            document.getElementById('cardTypeDisplay').textContent = getCardTypeDisplay(cardType);
            document.getElementById('cardLogo').textContent = getCardLogo(cardType);
            
            // Mise √† jour des identifiants
            document.getElementById('userIdDisplay').textContent = userId;
            document.getElementById('passwordDisplay').textContent = password;
            document.getElementById('expiryDateDisplay').textContent = formattedExpiryDate;
            
            // Affichage de la carte et des identifiants
            document.getElementById('bankCard').classList.remove('hidden');
            document.getElementById('credentials').classList.remove('hidden');
            document.getElementById('noCardMessage').classList.add('hidden');
            
            // Affichage du message de succ√®s
            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 5000);
            
            // Mise √† jour du tableau des clients
            updateClientsTable();
            
            // R√©initialisation du formulaire
            this.reset();
        });
        
        // Fonction pour mettre √† jour le tableau des clients
        function updateClientsTable() {
            const tableBody = document.getElementById('clientsTableBody');
            const noClientsMessage = document.getElementById('noClientsMessage');
            
            if (!tableBody) {
                console.error('√âl√©ment clientsTableBody non trouv√©');
                return;
            }
            
            // Vider le tableau
            tableBody.innerHTML = '';
            
            // Appliquer les filtres
            const searchTerm = document.getElementById('searchClient')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('filterStatus')?.value || 'all';
            const cardTypeFilter = document.getElementById('filterCardType')?.value || 'all';
            
            const filteredClients = clients.filter(client => {
                const matchesSearch = 
                    client.firstName.toLowerCase().includes(searchTerm) ||
                    client.lastName.toLowerCase().includes(searchTerm) ||
                    (client.city && client.city.toLowerCase().includes(searchTerm)) ||
                    (client.phoneNumber && client.phoneNumber.includes(searchTerm));
                
                const matchesStatus = statusFilter === 'all' || client.status === statusFilter;
                const matchesCardType = cardTypeFilter === 'all' || client.cardType === cardTypeFilter;
                
                return matchesSearch && matchesStatus && matchesCardType;
            });
            
            // Afficher le message si aucun client ne correspond
            if (filteredClients.length === 0) {
                if (noClientsMessage) noClientsMessage.classList.remove('hidden');
                tableBody.innerHTML = '';
                return;
            } else {
                if (noClientsMessage) noClientsMessage.classList.add('hidden');
            }
            
            // Ajouter chaque client au tableau
            filteredClients.forEach(client => {
                const expiryDate = new Date(client.expiryDate);
                const daysRemaining = Math.ceil((expiryDate - new Date()) / (1000 * 60 * 60 * 24));
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>
                        ${client.firstName} ${client.lastName}<br>
                        <small>${client.city || ''}</small><br>
                        <small>${client.phoneNumber || ''}</small>
                    </td>
                    <td>${getCardTypeDisplay(client.cardType)}</td>
                    <td>${formatCardNumber(client.cardNumber)}</td>
                    <td>${formatCurrency(client.balance)}</td>
                    <td>${formatDate(expiryDate)}</td>
                    <td><span class="status-badge status-${client.status}">${getStatusText(client.status, daysRemaining)}</span></td>
                    <td>
                        <button class="action-btn view-client" data-id="${client.id}">Voir</button>
                        <button class="action-btn manage-transactions" data-id="${client.id}">Transactions</button>
                        <button class="action-btn delete-client" data-id="${client.id}">Supprimer</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ajouter les √©v√©nements aux boutons
            document.querySelectorAll('.view-client').forEach(btn => {
                btn.addEventListener('click', function() {
                    const clientId = this.getAttribute('data-id');
                    viewClient(clientId);
                });
            });
            
            document.querySelectorAll('.manage-transactions').forEach(btn => {
                btn.addEventListener('click', function() {
                    const clientId = this.getAttribute('data-id');
                    manageTransactions(clientId);
                });
            });
            
            document.querySelectorAll('.delete-client').forEach(btn => {
                btn.addEventListener('click', function() {
                    const clientId = this.getAttribute('data-id');
                    deleteClient(clientId);
                });
            });
        }
        
        // Fonction pour afficher les d√©tails d'un client
        function viewClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;
            
            const expiryDate = new Date(client.expiryDate);
            const formattedExpiryDisplay = `${('0' + (expiryDate.getMonth() + 1)).slice(-2)}/${expiryDate.getFullYear().toString().slice(-2)}`;
            
            // Mise √† jour de la carte affich√©e
            document.getElementById('cardHolderDisplay').textContent = `${client.firstName} ${client.lastName}`.toUpperCase();
            document.getElementById('cardNumberDisplay').textContent = formatCardNumber(client.cardNumber);
            document.getElementById('cardExpiryDisplay').textContent = formattedExpiryDisplay;
            document.getElementById('cardCvvDisplay').textContent = client.cvv;
            document.getElementById('cardTypeDisplay').textContent = getCardTypeDisplay(client.cardType);
            document.getElementById('cardLogo').textContent = getCardLogo(client.cardType);
            
            // Mise √† jour des identifiants
            document.getElementById('userIdDisplay').textContent = client.userId;
            document.getElementById('passwordDisplay').textContent = client.password;
            document.getElementById('expiryDateDisplay').textContent = formatDate(expiryDate);
            
            // Affichage de la carte et des identifiants
            document.getElementById('bankCard').classList.remove('hidden');
            document.getElementById('credentials').classList.remove('hidden');
            document.getElementById('noCardMessage').classList.add('hidden');
            document.getElementById('successMessage').style.display = 'none';
            
            // D√©filement vers la carte
            document.getElementById('bankCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Fonction pour g√©rer les transactions d'un client
        function manageTransactions(clientId) {
            currentClientId = clientId;
            const client = clients.find(c => c.id === clientId);
            if (!client) return;
            
            // Afficher la section des transactions
            document.getElementById('transactionSection').classList.remove('hidden');
            
            // Mettre √† jour le solde affich√©
            updateBalanceDisplay(client);
            
            // Mettre √† jour l'historique des transactions
            updateTransactionHistory(client);
            
            // D√©filement vers la section des transactions
            document.getElementById('transactionSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Fonction pour mettre √† jour l'affichage du solde
        function updateBalanceDisplay(client) {
            const balanceElement = document.getElementById('accountBalance');
            if (balanceElement) {
                balanceElement.textContent = `Solde: ${formatCurrency(client.balance)}`;
            }
        }
        
        // Fonction pour mettre √† jour l'historique des transactions
        function updateTransactionHistory(client) {
            const historyContainer = document.getElementById('transactionHistory');
            if (!historyContainer) return;
            
            historyContainer.innerHTML = '';
            
            if (!client.transactions || client.transactions.length === 0) {
                historyContainer.innerHTML = '<p>Aucune transaction enregistr√©e.</p>';
                return;
            }
            
            // Trier les transactions par date (du plus r√©cent au plus ancien)
            const sortedTransactions = [...client.transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedTransactions.forEach(transaction => {
                const transactionItem = document.createElement('div');
                transactionItem.className = 'transaction-item';
                
                const transactionType = document.createElement('div');
                transactionType.className = 'transaction-type';
                transactionType.textContent = getTransactionTypeText(transaction.type);
                
                const transactionDetails = document.createElement('div');
                transactionDetails.className = 'transaction-details';
                
                const transactionAmount = document.createElement('div');
                transactionAmount.className = `transaction-amount ${transaction.amount >= 0 ? 'transaction-positive' : 'transaction-negative'}`;
                transactionAmount.textContent = `${transaction.amount >= 0 ? '+' : ''}${formatCurrency(transaction.amount)}`;
                
                transactionDetails.appendChild(transactionAmount);
                
                if (transaction.fee && transaction.fee > 0) {
                    const transactionFee = document.createElement('div');
                    transactionFee.className = 'transaction-fee';
                    transactionFee.textContent = `Frais: ${formatCurrency(transaction.fee)}`;
                    transactionDetails.appendChild(transactionFee);
                }
                
                if (transaction.party) {
                    const transactionParty = document.createElement('div');
                    transactionParty.className = 'transaction-party';
                    transactionParty.textContent = transaction.party;
                    transactionDetails.appendChild(transactionParty);
                }
                
                if (transaction.phone) {
                    const transactionPhone = document.createElement('div');
                    transactionPhone.className = 'transaction-party';
                    transactionPhone.textContent = transaction.phone;
                    transactionDetails.appendChild(transactionPhone);
                }
                
                const transactionDate = document.createElement('div');
                transactionDate.className = 'transaction-date';
                transactionDate.textContent = formatDateTime(new Date(transaction.date));
                
                const transactionReference = document.createElement('div');
                transactionReference.className = 'transaction-reference';
                transactionReference.textContent = `R√©f: ${transaction.reference || 'N/A'}`;
                
                transactionDetails.appendChild(transactionDate);
                transactionDetails.appendChild(transactionReference);
                
                transactionItem.appendChild(transactionType);
                transactionItem.appendChild(transactionDetails);
                
                historyContainer.appendChild(transactionItem);
            });
        }
        
        // Fonction pour basculer entre les onglets de transaction
        function switchTransactionTab(tabId) {
            // D√©sactiver tous les onglets
            document.querySelectorAll('.transaction-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // D√©sactiver tous les panneaux
            document.querySelectorAll('.transaction-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            const activeTab = document.querySelector(`.transaction-tab[data-tab="${tabId}"]`);
            if (activeTab) activeTab.classList.add('active');
            
            // Activer le panneau correspondant
            const activePanel = document.getElementById(`${tabId}Panel`);
            if (activePanel) activePanel.classList.add('active');
        }
        
        // Gestion de la recharge de carte
        function handleRecharge(e) {
            e.preventDefault();
            if (!currentClientId) {
                alert('Veuillez d\'abord s√©lectionner un client.');
                return;
            }
            
            const amountInput = document.getElementById('rechargeAmount');
            if (!amountInput) return;
            
            const amount = parseFloat(amountInput.value);
            if (isNaN(amount) || amount < 100) {
                alert('Veuillez entrer un montant valide (minimum 100 FCFA).');
                return;
            }
            
            const fee = amount * 0.06; // Frais de 6%
            const totalAmount = amount - fee;
            
            const client = clients.find(c => c.id === currentClientId);
            if (!client) return;
            
            // Mettre √† jour le solde
            client.balance += totalAmount;
            
            // G√©n√©rer une r√©f√©rence unique
            const reference = generateTransactionReference();
            
            // Enregistrer la transaction
            if (!client.transactions) client.transactions = [];
            
            client.transactions.push({
                type: 'recharge',
                amount: totalAmount,
                fee: fee,
                date: new Date().toISOString(),
                description: `Recharge de carte - Montant: ${formatCurrency(amount)}`,
                reference: reference
            });
            
            // Sauvegarde automatique
            autoSaveData();
            
            // Mettre √† jour l'affichage
            updateBalanceDisplay(client);
            updateTransactionHistory(client);
            
            // R√©initialiser le formulaire
            e.target.reset();
            
            alert(`Recharge effectu√©e avec succ√®s! Montant cr√©dit√©: ${formatCurrency(totalAmount)}, Frais: ${formatCurrency(fee)}, R√©f√©rence: ${reference}`);
        }
        
        // Gestion du transfert
        function handleTransfer(e) {
            e.preventDefault();
            if (!currentClientId) {
                alert('Veuillez d\'abord s√©lectionner un client.');
                return;
            }
            
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const recipient = document.getElementById('transferRecipient').value;
            const phone = document.getElementById('transferPhone').value;
            
            if (isNaN(amount) || amount < 100) {
                alert('Veuillez entrer un montant valide (minimum 100 FCFA).');
                return;
            }
            
            if (!recipient || !phone) {
                alert('Veuillez remplir tous les champs.');
                return;
            }
            
            const client = clients.find(c => c.id === currentClientId);
            if (!client) return;
            
            // V√©rifier si le solde est suffisant
            if (client.balance < amount) {
                alert('Solde insuffisant pour effectuer ce transfert.');
                return;
            }
            
            // Mettre √† jour le solde
            client.balance -= amount;
            
            // G√©n√©rer une r√©f√©rence unique
            const reference = generateTransactionReference();
            
            // Enregistrer la transaction
            if (!client.transactions) client.transactions = [];
            
            client.transactions.push({
                type: 'transfer',
                amount: -amount,
                date: new Date().toISOString(),
                party: recipient,
                phone: phone,
                description: `Transfert √† ${recipient}`,
                reference: reference
            });
            
            // Sauvegarde automatique
            autoSaveData();
            
            // Mettre √† jour l'affichage
            updateBalanceDisplay(client);
            updateTransactionHistory(client);
            
            // R√©initialiser le formulaire
            e.target.reset();
            
            alert(`Transfert de ${formatCurrency(amount)} √† ${recipient} (${phone}) effectu√© avec succ√®s! R√©f√©rence: ${reference}`);
        }
        
        // Gestion de la r√©ception
        function handleReceive(e) {
            e.preventDefault();
            if (!currentClientId) {
                alert('Veuillez d\'abord s√©lectionner un client.');
                return;
            }
            
            const amount = parseFloat(document.getElementById('receiveAmount').value);
            const sender = document.getElementById('receiveSender').value;
            const phone = document.getElementById('receiveSenderPhone').value;
            
            if (isNaN(amount) || amount < 100) {
                alert('Veuillez entrer un montant valide (minimum 100 FCFA).');
                return;
            }
            
            if (!sender || !phone) {
                alert('Veuillez remplir tous les champs.');
                return;
            }
            
            const client = clients.find(c => c.id === currentClientId);
            if (!client) return;
            
            // Mettre √† jour le solde
            client.balance += amount;
            
            // G√©n√©rer une r√©f√©rence unique
            const reference = generateTransactionReference();
            
            // Enregistrer la transaction
            if (!client.transactions) client.transactions = [];
            
            client.transactions.push({
                type: 'receive',
                amount: amount,
                date: new Date().toISOString(),
                party: sender,
                phone: phone,
                description: `R√©ception de ${sender}`,
                reference: reference
            });
            
            // Sauvegarde automatique
            autoSaveData();
            
            // Mettre √† jour l'affichage
            updateBalanceDisplay(client);
            updateTransactionHistory(client);
            
            // R√©initialiser le formulaire
            e.target.reset();
            
            alert(`R√©ception de ${formatCurrency(amount)} de ${sender} (${phone}) enregistr√©e avec succ√®s! R√©f√©rence: ${reference}`);
        }
        
        // Gestion du retrait
        function handleWithdraw(e) {
            e.preventDefault();
            if (!currentClientId) {
                alert('Veuillez d\'abord s√©lectionner un client.');
                return;
            }
            
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const phone = document.getElementById('withdrawPhone').value;
            
            if (isNaN(amount) || amount < 100) {
                alert('Veuillez entrer un montant valide (minimum 100 FCFA).');
                return;
            }
            
            if (!phone) {
                alert('Veuillez entrer un num√©ro de t√©l√©phone.');
                return;
            }
            
            const fee = amount * 0.15; // Frais de 15%
            const totalAmount = amount + fee;
            
            const client = clients.find(c => c.id === currentClientId);
            if (!client) return;
            
            // V√©rifier si le solde est suffisant
            if (client.balance < totalAmount) {
                alert('Solde insuffisant pour effectuer ce retrait (incluant les frais).');
                return;
            }
            
            // Mettre √† jour le solde
            client.balance -= totalAmount;
            
            // G√©n√©rer une r√©f√©rence unique
            const reference = generateTransactionReference();
            
            // Enregistrer la transaction
            if (!client.transactions) client.transactions = [];
            
            client.transactions.push({
                type: 'withdraw',
                amount: -totalAmount,
                fee: fee,
                date: new Date().toISOString(),
                phone: phone,
                description: `Retrait Mobile Money - Montant: ${formatCurrency(amount)}`,
                reference: reference
            });
            
            // Sauvegarde automatique
            autoSaveData();
            
            // Mettre √† jour l'affichage
            updateBalanceDisplay(client);
            updateTransactionHistory(client);
            
            // R√©initialiser le formulaire
            e.target.reset();
            
            alert(`Retrait effectu√© avec succ√®s! Montant retir√©: ${formatCurrency(amount)}, Frais: ${formatCurrency(fee)}, R√©f√©rence: ${reference}`);
        }
        
        // Fonction pour sauvegarder les transactions du client actuel
        function saveTransactions() {
            if (!currentClientId) {
                alert('Veuillez d\'abord s√©lectionner un client pour sauvegarder ses transactions.');
                return;
            }
            
            const client = clients.find(c => c.id === currentClientId);
            if (!client) return;
            
            const data = {
                client: {
                    id: client.id,
                    firstName: client.firstName,
                    lastName: client.lastName,
                    phoneNumber: client.phoneNumber,
                    cardNumber: formatCardNumber(client.cardNumber),
                    balance: client.balance
                },
                transactions: client.transactions || [],
                exportDate: new Date().toISOString(),
                totalTransactions: (client.transactions || []).length
            };
            
            const filename = `transactions_${client.firstName}_${client.lastName}_${formatDateForFile(new Date())}.json`;
            downloadJSON(data, filename);
            
            updateLastBackupTime();
            alert(`Transactions sauvegard√©es avec succ√®s! Fichier: ${filename}`);
        }
        
        // Fonction pour sauvegarder toutes les donn√©es
        function backupAllData() {
            const data = {
                clients: clients,
                exportDate: new Date().toISOString(),
                totalClients: clients.length,
                totalTransactions: clients.reduce((total, client) => total + (client.transactions ? client.transactions.length : 0), 0)
            };
            
            const filename = `sauvegarde_complete_${formatDateForFile(new Date())}.json`;
            downloadJSON(data, filename);
            
            updateLastBackupTime();
            alert(`Sauvegarde compl√®te effectu√©e avec succ√®s! Fichier: ${filename}`);
        }
        
        // Fonction pour sauvegarder uniquement les clients
        function backupClients() {
            const data = {
                clients: clients.map(client => {
                    const { transactions, ...clientData } = client;
                    return clientData;
                }),
                exportDate: new Date().toISOString(),
                totalClients: clients.length
            };
            
            const filename = `clients_${formatDateForFile(new Date())}.json`;
            downloadJSON(data, filename);
            
            updateLastBackupTime();
            alert(`Clients sauvegard√©s avec succ√®s! Fichier: ${filename}`);
        }
        
        // Fonction pour sauvegarder uniquement les transactions
        function backupTransactions() {
            const allTransactions = [];
            
            clients.forEach(client => {
                if (client.transactions) {
                    client.transactions.forEach(transaction => {
                        allTransactions.push({
                            clientId: client.id,
                            clientName: `${client.firstName} ${client.lastName}`,
                            ...transaction
                        });
                    });
                }
            });
            
            const data = {
                transactions: allTransactions,
                exportDate: new Date().toISOString(),
                totalTransactions: allTransactions.length
            };
            
            const filename = `toutes_transactions_${formatDateForFile(new Date())}.json`;
            downloadJSON(data, filename);
            
            updateLastBackupTime();
            alert(`Toutes les transactions sauvegard√©es avec succ√®s! Fichier: ${filename}`);
        }
        
        // Fonction pour sauvegarder le tableau des clients
        function saveClientsTable() {
            const data = {
                clients: clients.map(client => {
                    const { transactions, password, cvv, ...clientData } = client;
                    return clientData;
                }),
                exportDate: new Date().toISOString(),
                totalClients: clients.length
            };
            
            const filename = `liste_clients_${formatDateForFile(new Date())}.json`;
            downloadJSON(data, filename);
            
            updateLastBackupTime();
            alert(`Liste des clients sauvegard√©e avec succ√®s! Fichier: ${filename}`);
        }
        
        // Fonction pour t√©l√©charger un fichier JSON
        function downloadJSON(data, filename) {
            try {
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = filename;
                link.click();
                
                URL.revokeObjectURL(link.href);
                
                // Enregistrer l'heure de la sauvegarde manuelle
                localStorage.setItem('lastBackupTime', new Date().toISOString());
                updateSessionInfo();
            } catch (error) {
                console.error('Erreur lors du t√©l√©chargement:', error);
                alert('Erreur lors de la sauvegarde du fichier.');
            }
        }
        
        // Fonction pour mettre √† jour l'heure de la derni√®re sauvegarde
        function updateLastBackupTime() {
            const now = new Date();
            document.getElementById('lastBackupTime').textContent = formatDateTime(now);
        }
        
        // Fonction pour formater la date pour les noms de fichiers
        function formatDateForFile(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}_${hours}${minutes}`;
        }
        
        // Gestion de la s√©lection de fichier
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('importData').disabled = false;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const fileContent = e.target.result;
                    const importedData = JSON.parse(fileContent);
                    
                    // Afficher un aper√ßu des donn√©es
                    showImportPreview(importedData);
                } catch (error) {
                    alert('Erreur: Le fichier s√©lectionn√© n\'est pas un fichier JSON valide.');
                    document.getElementById('importData').disabled = true;
                    document.getElementById('importPreview').classList.add('hidden');
                }
            };
            reader.readAsText(file);
        }
        
        // Fonction pour afficher l'aper√ßu des donn√©es √† importer
        function showImportPreview(data) {
            const preview = document.getElementById('importPreview');
            preview.innerHTML = '';
            preview.classList.remove('hidden');
            
            let previewContent = '';
            
            if (data.clients && Array.isArray(data.clients)) {
                previewContent += `<p><strong>Clients:</strong> ${data.clients.length} trouv√©(s)</p>`;
                if (data.clients.length > 0) {
                    previewContent += '<ul>';
                    data.clients.slice(0, 3).forEach(client => {
                        previewContent += `<li>${client.firstName} ${client.lastName} - ${client.cardType || 'N/A'}</li>`;
                    });
                    if (data.clients.length > 3) {
                        previewContent += `<li>... et ${data.clients.length - 3} autres</li>`;
                    }
                    previewContent += '</ul>';
                }
            }
            
            if (data.transactions && Array.isArray(data.transactions)) {
                previewContent += `<p><strong>Transactions:</strong> ${data.transactions.length} trouv√©e(s)</p>`;
            }
            
            if (data.exportDate) {
                previewContent += `<p><strong>Date d'export:</strong> ${formatDateTime(new Date(data.exportDate))}</p>`;
            }
            
            preview.innerHTML = previewContent;
        }
        
        // Fonction pour importer les donn√©es
        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            const importMode = document.querySelector('input[name="importMode"]:checked').value;
            
            if (!file) {
                alert('Veuillez d\'abord s√©lectionner un fichier √† importer.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const fileContent = e.target.result;
                    const importedData = JSON.parse(fileContent);
                    
                    if (importMode === 'replace') {
                        // Remplacer toutes les donn√©es
                        if (confirm('√ätes-vous s√ªr de vouloir remplacer toutes les donn√©es actuelles ? Cette action est irr√©versible.')) {
                            if (importedData.clients) {
                                clients = importedData.clients;
                                autoSaveData();
                                updateClientsTable();
                                alert('Donn√©es import√©es avec succ√®s! Toutes les donn√©es pr√©c√©dentes ont √©t√© remplac√©es.');
                            } else {
                                alert('Erreur: Le fichier ne contient pas de donn√©es clients valides.');
                            }
                        }
                    } else if (importMode === 'merge') {
                        // Fusionner avec les donn√©es existantes
                        if (importedData.clients) {
                            const existingIds = clients.map(c => c.id);
                            let newClientsCount = 0;
                            let updatedClientsCount = 0;
                            
                            importedData.clients.forEach(importedClient => {
                                const existingIndex = clients.findIndex(c => c.id === importedClient.id);
                                
                                if (existingIndex !== -1) {
                                    // Mettre √† jour le client existant
                                    clients[existingIndex] = { ...clients[existingIndex], ...importedClient };
                                    updatedClientsCount++;
                                } else {
                                    // Ajouter un nouveau client
                                    clients.push(importedClient);
                                    newClientsCount++;
                                }
                            });
                            
                            autoSaveData();
                            updateClientsTable();
                            
                            alert(`Donn√©es fusionn√©es avec succ√®s! ${newClientsCount} nouveau(x) client(s) ajout√©(s), ${updatedClientsCount} client(s) mis √† jour.`);
                        } else {
                            alert('Erreur: Le fichier ne contient pas de donn√©es clients valides.');
                        }
                    }
                    
                    // R√©initialiser le formulaire
                    fileInput.value = '';
                    document.getElementById('fileName').textContent = 'Aucun fichier s√©lectionn√©';
                    document.getElementById('importData').disabled = true;
                    document.getElementById('importPreview').classList.add('hidden');
                    
                } catch (error) {
                    alert('Erreur lors de l\'importation: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // Fonction pour imprimer les transactions
        function printTransactions() {
            if (!currentClientId) return;
            
            const client = clients.find(c => c.id === currentClientId);
            if (!client) return;
            
            const printableContent = document.getElementById('printable-transactions');
            printableContent.innerHTML = '';
            
            // Cr√©er le contenu imprimable
            const printHeader = document.createElement('div');
            printHeader.innerHTML = `
                <h1>Relev√© de Transactions</h1>
                <h2>${client.firstName} ${client.lastName}</h2>
                <p>Num√©ro de carte: ${formatCardNumber(client.cardNumber)}</p>
                <p>Solde actuel: ${formatCurrency(client.balance)}</p>
                <p>Date d'impression: ${formatDateTime(new Date())}</p>
                <hr>
            `;
            printableContent.appendChild(printHeader);
            
            if (!client.transactions || client.transactions.length === 0) {
                const noTransactions = document.createElement('p');
                noTransactions.textContent = 'Aucune transaction enregistr√©e.';
                printableContent.appendChild(noTransactions);
            } else {
                // Trier les transactions par date (du plus r√©cent au plus ancien)
                const sortedTransactions = [...client.transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const transactionsTable = document.createElement('table');
                transactionsTable.style.width = '100%';
                transactionsTable.style.borderCollapse = 'collapse';
                transactionsTable.style.marginTop = '20px';
                
                // En-t√™te du tableau
                const tableHeader = document.createElement('tr');
                tableHeader.innerHTML = `
                    <th style="border: 1px solid #000; padding: 8px; text-align: left;">Date/Heure</th>
                    <th style="border: 1px solid #000; padding: 8px; text-align: left;">Type</th>
                    <th style="border: 1px solid #000; padding: 8px; text-align: left;">Montant</th>
                    <th style="border: 1px solid #000; padding: 8px; text-align: left;">Frais</th>
                    <th style="border: 1px solid #000; padding: 8px; text-align: left;">Partie</th>
                    <th style="border: 1px solid #000; padding: 8px; text-align: left;">R√©f√©rence</th>
                `;
                transactionsTable.appendChild(tableHeader);
                
                // Lignes du tableau
                sortedTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="border: 1px solid #000; padding: 8px;">${formatDateTime(new Date(transaction.date))}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${getTransactionTypeText(transaction.type)}</td>
                        <td style="border: 1px solid #000; padding: 8px; ${transaction.amount >= 0 ? 'color: green;' : 'color: red;'}">${formatCurrency(transaction.amount)}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${transaction.fee ? formatCurrency(transaction.fee) : '-'}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${transaction.party || transaction.phone || '-'}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${transaction.reference || 'N/A'}</td>
                    `;
                    transactionsTable.appendChild(row);
                });
                
                printableContent.appendChild(transactionsTable);
            }
            
            // Afficher la section d'impression et imprimer
            printableContent.classList.remove('hidden');
            window.print();
            printableContent.classList.add('hidden');
        }
        
        // Fonction pour supprimer un client
        function deleteClient(clientId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce client ?')) {
                clients = clients.filter(c => c.id !== clientId);
                autoSaveData();
                updateClientsTable();
                
                // Si le client supprim√© √©tait affich√©, masquer la carte
                const displayedCard = document.getElementById('bankCard');
                if (displayedCard && !displayedCard.classList.contains('hidden')) {
                    // V√©rifier si la carte affich√©e appartient au client supprim√©
                    const cardNumber = document.getElementById('cardNumberDisplay').textContent.replace(/\s/g, '');
                    const client = clients.find(c => formatCardNumber(c.cardNumber) === cardNumber);
                    
                    if (!client) {
                        document.getElementById('bankCard').classList.add('hidden');
                        document.getElementById('credentials').classList.add('hidden');
                        document.getElementById('noCardMessage').classList.remove('hidden');
                    }
                }
                
                // Si le client supprim√© √©tait en cours de gestion des transactions
                if (currentClientId === clientId) {
                    document.getElementById('transactionSection').classList.add('hidden');
                    currentClientId = null;
                }
            }
        }
        
        // Fonction pour g√©n√©rer un ID client unique
        function generateClientId() {
            return 'CLI' + Date.now() + Math.floor(Math.random() * 1000);
        }
        
        // Fonction pour g√©n√©rer une r√©f√©rence de transaction unique
        function generateTransactionReference() {
            return 'REF' + Date.now() + Math.floor(Math.random() * 1000);
        }
        
        // Fonction pour d√©terminer le statut de la carte
        function getCardStatus(expiryDate) {
            const today = new Date();
            const diffTime = expiryDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) return 'expired';
            if (diffDays < 30) return 'warning';
            return 'active';
        }
        
        // Fonction pour obtenir le texte du statut
        function getStatusText(status, daysRemaining) {
            switch(status) {
                case 'active': return `Valide (${daysRemaining} jours)`; 
                case 'warning': return `Expire dans ${daysRemaining} jours`;
                case 'expired': return 'Expir√©e';
                default: return 'Inconnu';
            }
        }
        
        // Fonction pour obtenir le texte du type de transaction
        function getTransactionTypeText(type) {
            switch(type) {
                case 'recharge': return 'Recharge';
                case 'transfer': return 'Transfert';
                case 'receive': return 'R√©ception';
                case 'withdraw': return 'Retrait';
                default: return 'Transaction';
            }
        }
        
        // Fonction pour g√©n√©rer un num√©ro de carte selon le type
        function generateCardNumber(type) {
            let prefix;
            switch(type) {
                case 'visa':
                    prefix = '4';
                    break;
                case 'mastercard':
                    prefix = '5';
                    break;
                case 'virtual':
                    prefix = '4'; // Les cartes virtuelles commencent souvent par 4
                    break;
                default:
                    prefix = '4';
            }
            
            let number = prefix;
            // G√©n√©rer les 15 chiffres restants
            for (let i = 0; i < 15; i++) {
                number += Math.floor(Math.random() * 10);
            }
            
            return number;
        }
        
        // Fonction pour formater le num√©ro de carte en groupes de 4 chiffres
        function formatCardNumber(number) {
            return number.replace(/(.{4})/g, '$1 ').trim();
        }
        
        // Fonction pour g√©n√©rer un CVV
        function generateCVV() {
            let cvv = '';
            for (let i = 0; i < 3; i++) {
                cvv += Math.floor(Math.random() * 10);
            }
            return cvv;
        }
        
        // Fonction pour g√©n√©rer un identifiant unique
        function generateUserId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // Fonction pour g√©n√©rer un mot de passe s√©curis√©
        function generatePassword() {
            const lowercase = 'abcdefghijklmnopqrstuvwxyz';
            const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const numbers = '0123456789';
            const symbols = '!@#$%^&*';
            
            let password = '';
            
            // Au moins un caract√®re de chaque type
            password += lowercase.charAt(Math.floor(Math.random() * lowercase.length));
            password += uppercase.charAt(Math.floor(Math.random() * uppercase.length));
            password += numbers.charAt(Math.floor(Math.random() * numbers.length));
            password += symbols.charAt(Math.floor(Math.random() * symbols.length));
            
            // Remplir le reste
            const allChars = lowercase + uppercase + numbers + symbols;
            for (let i = 4; i < 12; i++) {
                password += allChars.charAt(Math.floor(Math.random() * allChars.length));
            }
            
            // M√©langer le mot de passe
            return password.split('').sort(() => 0.5 - Math.random()).join('');
        }
        
        // Fonction pour formater une date
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Fonction pour formater une date et heure
        function formatDateTime(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }
        
        // Fonction pour formater une monnaie
        function formatCurrency(amount) {
            return new Intl.NumberFormat('fr-FR', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount) + ' FCFA';
        }
        
        // Fonction pour obtenir l'affichage du type de carte
        function getCardTypeDisplay(type) {
            switch(type) {
                case 'visa': return 'Visa';
                case 'mastercard': return 'Mastercard';
                case 'virtual': return 'Virtuelle';
                default: return 'Carte';
            }
        }
        
        // Fonction pour obtenir le logo de la carte
        function getCardLogo(type) {
            switch(type) {
                case 'visa': return 'VISA';
                case 'mastercard': return 'MC';
                case 'virtual': return 'Virtuelle';
                default: return 'Carte';
            }
        }
    </script>
</body>
</html>
